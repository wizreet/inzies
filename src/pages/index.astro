---
import { Icon } from "astro-icon/components";
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/layout/Navbar.astro";
import Footer from "../components/layout/Footer.astro";
import SocialLinks from "../components/social/SocialLinks.astro";
import GlowButton from "../components/ui/GlowButton.astro";
import ReleaseCard from "../components/music/ReleaseCard.astro";
import { siteConfig } from "../config";
import { getLatestRelease } from "../data/releases";

const latestRelease = getLatestRelease();
---

<Layout>
	<div class="relative min-h-screen flex flex-col z-10">
		<Navbar />

		<!-- Hero Section -->
		<section id="hero-trigger" class="group relative min-h-screen flex items-start justify-center overflow-hidden pt-40 md:pt-80">
			<div class="absolute inset-0 bg-gradient-to-br from-inzies-black via-inzies-black-800 to-inzies-black"></div>
			<div class="absolute inset-0 grid-bg opacity-20"></div>
			<div class="absolute top-1/4 -left-32 w-96 h-96 bg-inzies-orange/20 rounded-full blur-[128px]"></div>
			<div class="absolute bottom-1/4 -right-32 w-96 h-96 bg-inzies-blue/20 rounded-full blur-[128px]"></div>

			<div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">

				<!-- Logo Container -->
				<div class="mb-16 animate-fade-in flex justify-center">
					<!-- Container width: w-56 on mobile, larger on desktop -->
					<div class="relative w-56 md:w-96 lg:w-[32rem] h-48 logo-container cursor-pointer">

						<div class="absolute inset-0 flex items-center justify-center logo-static-wrapper">
							<img
								src="/inzies/LogoAnimations/logo-transparent.png"
								alt="Inzies Logo"
								class="w-full h-auto logo-static"
							/>
						</div>

						<div class="absolute inset-0 flex items-center justify-center logo-gif-wrapper">
							<img
								id="main-logo-gif"
								data-src="/inzies/LogoAnimations/Logo-gif.gif"
								src=""
								alt="Inzies Animated Logo"
								class="logo-gif"
							/>
						</div>
					</div>
				</div>

				<!-- Title (Indie Music Band) -->
				<div class="mb-8 animate-fade-in" style="animation-delay: 0.2s;">
					<p class="text-xl md:text-3xl text-[#FF6B00] font-bold tracking-wider uppercase">
						{siteConfig.subtitle}
					</p>
				</div>

				{siteConfig.description && (
					<p class="max-w-2xl mx-auto text-lg md:text-xl text-[var(--text-secondary)] mb-12 animate-slide-up" style="animation-delay: 0.3s;">
						{siteConfig.description}
					</p>
				)}

				<!-- Social Links -->
				<div class="flex flex-col items-center animate-slide-up mt-24" style="animation-delay: 0.5s;">
					<SocialLinks />
					<p class="mt-8 text-sm text-[var(--text-secondary)]">
						Follow us on our social channels
					</p>
				</div>
			</div>
		</section>

		<!-- Latest Release Section -->
		{latestRelease && (
			<section class="py-24 bg-[var(--bg-secondary)]/30">
				<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
					<h2 class="section-title mb-12 scroll-reveal">Latest Release</h2>
					<div class="scroll-reveal" style="animation-delay: 0.2s;">
						<ReleaseCard release={latestRelease} />
					</div>
				</div>
			</section>
		)}

		<Footer />
	</div>
</Layout>

<style>
	.logo-container { overflow: visible; }

	.logo-static-wrapper {
		transition: opacity 0.3s ease;
		z-index: 2;
	}

	.logo-gif-wrapper {
		opacity: 0;
		transition: opacity 0.3s ease;
		pointer-events: none;
		z-index: 1;
	}

	.logo-gif {
		width: 100%;
		height: auto;
		transform-origin: center center;
		/* DESKTOP SCALE */
		transform: scale(2.25);
	}

	/* MOBILE ADJUSTMENTS */
	@media (max-width: 767px) {
		.logo-gif {
			/*
			   Reduced scale for mobile to match the static text size exactly.
			   Added translateY(2px) to fix the vertical alignment from your screenshot.
			*/
			transform: scale(1.85) translateY(2px);
		}
	}

	.group:hover .logo-static-wrapper,
	.logo-container.is-active .logo-static-wrapper {
		opacity: 0;
	}

	.group:hover .logo-gif-wrapper,
	.logo-container.is-active .logo-gif-wrapper {
		opacity: 1;
	}
</style>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const section = document.getElementById('hero-trigger');
		const container = document.querySelector('.logo-container');
		const gifImg = document.getElementById('main-logo-gif') as HTMLImageElement;
		const gifSrc = gifImg?.getAttribute('data-src');

		let isPlaying = false;

		const startAnimation = () => {
			if (!isPlaying && gifImg && gifSrc) {
				gifImg.src = `${gifSrc}?t=${new Date().getTime()}`;
				isPlaying = true;
				container?.classList.add('is-active');
			}
		};

		const stopAnimation = () => {
			isPlaying = false;
			container?.classList.remove('is-active');
		};

		section?.addEventListener('mouseenter', startAnimation);
		section?.addEventListener('mouseleave', stopAnimation);

		if (container) {
			const observer = new IntersectionObserver((entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting && entry.intersectionRatio > 0.3) {
						startAnimation();
					} else {
						if (!section?.matches(':hover')) {
							stopAnimation();
						}
					}
				});
			}, {
				threshold: [0, 0.3, 1],
				rootMargin: '150px 0px 150px 0px'
			});
			observer.observe(container);
		}
	});
</script>
