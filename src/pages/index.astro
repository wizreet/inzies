---
/**
 * Home Page
 *
 * Main landing page with hero section, latest release, and CTA.
 * Optimized for fast rendering with lazy loading and deferred scripts.
 */
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/layout/Navbar.astro";
import Footer from "../components/layout/Footer.astro";
import SocialLinks from "../components/social/SocialLinks.astro";
import GlowButton from "../components/ui/GlowButton.astro";
import ReleaseCard from "../components/music/ReleaseCard.astro";
import { siteConfig } from "../config";
import { getLatestRelease } from "../data/releases";
import { ROUTES, ASSET_PATHS } from "../constants";

const latestRelease = getLatestRelease();
---

<Layout>
	<div class="relative z-10 flex min-h-screen flex-col">
		<Navbar />

		<!-- Hero Section -->
		<section
			id="hero-trigger"
			class="group relative flex min-h-0 items-start justify-center overflow-hidden pb-4 pt-32 md:min-h-screen md:pb-0 md:pt-80"
			aria-label="Hero"
		>
			<!-- Background Gradient -->
			<div
				class="absolute inset-0 bg-gradient-to-br from-inzies-black via-inzies-black-800 to-inzies-black"
				aria-hidden="true"
			>
			</div>
			<!-- Animated Grid Background -->
			<div class="grid-bg absolute inset-0 opacity-20" aria-hidden="true"></div>

			<!-- Glow Effects -->
			<div
				class="absolute -left-32 top-1/4 h-96 w-96 rounded-full bg-inzies-orange/20 blur-[128px]"
				aria-hidden="true"
			>
			</div>
			<div
				class="absolute -right-32 bottom-1/4 h-96 w-96 rounded-full bg-inzies-blue/20 blur-[128px]"
				aria-hidden="true"
			>
			</div>

			<div class="relative z-10 mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
				<!-- Logo Container -->
				<div class="mb-12 flex animate-fade-in justify-center md:mb-16">
					<div
						class="logo-container relative h-40 w-52 cursor-pointer md:h-48 md:w-96 lg:w-[32rem]"
					>
						<div class="logo-static-wrapper absolute inset-0 flex items-center justify-center">
							<img
								src={`${ASSET_PATHS.LOGOS}/logo-transparent.png`}
								alt={`${siteConfig.title} Logo`}
								class="logo-static h-auto w-full"
								width="512"
								height="192"
								fetchpriority="high"
							/>
						</div>
						<div
							class="logo-gif-wrapper absolute inset-0 flex items-center justify-center"
							aria-hidden="true"
						>
							<img
								id="main-logo-gif"
								data-src={`${ASSET_PATHS.LOGOS}/Logo-gif.gif`}
								src=""
								alt=""
								class="logo-gif"
							/>
						</div>
					</div>
				</div>

				<!-- Title -->
				<div class="mb-6 animate-fade-in md:mb-8" style="animation-delay: 0.2s;">
					<h1 class="text-xl font-bold uppercase tracking-wider text-inzies-orange md:text-3xl">
						{siteConfig.subtitle}
					</h1>
				</div>

				{
					siteConfig.description && (
						<p
							class="mx-auto mb-10 max-w-2xl animate-slide-up text-lg text-[var(--text-secondary)] md:mb-12 md:text-xl"
							style="animation-delay: 0.3s;"
						>
							{siteConfig.description}
						</p>
					)
				}

				<!-- Social Links -->
				<div
					class="mt-8 flex animate-slide-up flex-col items-center md:mt-12"
					style="animation-delay: 0.5s;"
				>
					<SocialLinks />
					<p class="mt-4 text-sm text-[var(--text-secondary)] md:mt-6">
						Find us on our social channels
					</p>
				</div>
			</div>
		</section>

		<!-- Latest Release Section -->
		{
			latestRelease && (
				<section
					class="bg-[var(--bg-secondary)]/30 py-12 md:py-16"
					aria-labelledby="latest-release-heading"
				>
					<div class="mx-auto max-w-7xl px-6 sm:px-8 lg:px-8">
						<h2 id="latest-release-heading" class="section-title scroll-reveal mb-6 md:mb-8">
							Latest Release
						</h2>
						<div class="scroll-reveal" style="animation-delay: 0.2s;">
							<ReleaseCard release={latestRelease} priority />
						</div>
					</div>
				</section>
			)
		}

		<!-- Play Along CTA -->
		<section class="py-12 md:py-16" aria-labelledby="remix-heading">
			<div class="mx-auto max-w-7xl px-6 sm:px-8 lg:px-8">
				<h2 id="remix-heading" class="section-title scroll-reveal mb-6 md:mb-8">
					Remix Our Stuff
				</h2>

				<div class="scroll-reveal" style="animation-delay: 0.2s;">
					<div class="card-base p-8 text-center md:p-12">
						<p class="mx-auto mb-8 max-w-2xl text-lg text-[var(--text-secondary)]">
							We put our beats on Strudel. You can mess with them, remix them, whatever.
						</p>
						<GlowButton href={ROUTES.PLAY} variant="primary" size="lg" icon="material-symbols:code">
							Play Around
						</GlowButton>
					</div>
				</div>
			</div>
		</section>

		<Footer />
	</div>
</Layout>

<style>
	.logo-container {
		overflow: visible;
	}

	.logo-static-wrapper {
		transition: opacity 0.3s ease;
		z-index: 2;
	}

	.logo-gif-wrapper {
		opacity: 0;
		transition: opacity 0.3s ease;
		pointer-events: none;
		z-index: 1;
	}

	.logo-gif {
		width: 100%;
		height: auto;
		transform-origin: center center;
		transform: scale(2.25);
	}

	@media (max-width: 767px) {
		.logo-gif {
			transform: scale(1.7) translateY(2px);
		}
	}

	.group:hover .logo-static-wrapper,
	.logo-container.is-active .logo-static-wrapper {
		opacity: 0;
	}

	.group:hover .logo-gif-wrapper,
	.logo-container.is-active .logo-gif-wrapper {
		opacity: 1;
	}
</style>

<script>
	document.addEventListener("DOMContentLoaded", () => {
		const section = document.getElementById("hero-trigger");
		const container = document.querySelector(".logo-container");
		const gifImg = document.getElementById("main-logo-gif") as HTMLImageElement;
		const gifSrc = gifImg?.getAttribute("data-src");

		let isPlaying = false;

		const startAnimation = () => {
			if (!isPlaying && gifImg && gifSrc) {
				gifImg.src = `${gifSrc}?t=${new Date().getTime()}`;
				isPlaying = true;
				container?.classList.add("is-active");
			}
		};

		const stopAnimation = () => {
			isPlaying = false;
			container?.classList.remove("is-active");
		};

		section?.addEventListener("mouseenter", startAnimation);
		section?.addEventListener("mouseleave", stopAnimation);

		if (container) {
			const observer = new IntersectionObserver(
				(entries) => {
					entries.forEach((entry) => {
						if (entry.isIntersecting && entry.intersectionRatio > 0.3) {
							startAnimation();
						} else {
							const isHovered = document.querySelector("#hero-trigger:hover");
							if (!isHovered) {
								stopAnimation();
							}
						}
					});
				},
				{
					threshold: [0, 0.3, 1],
					rootMargin: "100px 0px 100px 0px",
				}
			);
			observer.observe(container);
		}
	});
</script>
